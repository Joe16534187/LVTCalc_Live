<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Land Value Tax Calculator - Scotland</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://unpkg.com/maplibre-gl@4/dist/maplibre-gl.css" rel="stylesheet">
    <style>
        #map { position: relative; width: 100%; height: 100%; }
        .maplibregl-map { width: 100%; height: 100%; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Land Value Tax Calculator</h1>
            <p class="subtitle">Compare your current tax burden with a Land Value Tax system</p>
        </div>
    </header>

    <main>
        <div class="layout-grid">
            <!-- Map Section -->
            <div class="map-container">
                <div id="map"></div>

                <!-- Loading Indicator -->
                <div id="loadingOverlay" class="loading-overlay">
                    <div class="loading-content">
                        <div class="spinner"></div>
                        <p class="loading-text">Loading properties...</p>
                        <p class="loading-subtext">This may take a few moments</p>
                    </div>
                </div>

                <div class="map-legend">
                    <div class="legend-title">Land Value per m²</div>
                    <div class="legend-items">
                        <div class="legend-item"><span class="legend-colour" style="background: #1e3a8a;"></span><span class="legend-label">£0 – £100</span></div>
                        <div class="legend-item"><span class="legend-colour" style="background: #2563eb;"></span><span class="legend-label">£100 – £200</span></div>
                        <div class="legend-item"><span class="legend-colour" style="background: #0ea5e9;"></span><span class="legend-label">£200 – £400</span></div>
                        <div class="legend-item"><span class="legend-colour" style="background: #06b6d4;"></span><span class="legend-label">£400 – £800</span></div>
                        <div class="legend-item"><span class="legend-colour" style="background: #14b8a6;"></span><span class="legend-label">£800 – £1,600</span></div>
                        <div class="legend-item"><span class="legend-colour" style="background: #10b981;"></span><span class="legend-label">£1,600 – £3,200</span></div>
                        <div class="legend-item"><span class="legend-colour" style="background: #22c55e;"></span><span class="legend-label">£3,200+</span></div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Property Details Panel -->
                <div class="panel">
                    <h2>Property Details</h2>
                    <div id="propertyDetails">
                        <p class="placeholder-text">Click on a property to view details</p>
                    </div>
                </div>

                <!-- Tax Comparison Calculator -->
                <div class="panel">
                    <h2>Tax Comparison</h2>
                    <div id="taxCalculator">
                        <p class="info-text">Select a property above to compare taxes</p>

                        <div class="calculator-form" id="calculatorForm" style="display: none;">
                            <p class="instruction-text">Select which taxes you want to replace with Land Value Tax:</p>

                            <div class="tax-option">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="includeCouncilTax" checked>
                                    <span class="checkbox-text">Council Tax (annual)</span>
                                </label>
                                <div class="input-group">
                                    <label for="actualCouncilTax">You currently pay:</label>
                                    <div class="input-wrapper">
                                        <span class="currency-symbol">£</span>
                                        <input type="number" id="actualCouncilTax" placeholder="0.00" step="0.01" min="0">
                                        <span class="input-suffix">per year</span>
                                    </div>
                                </div>
                            </div>

                            <div class="tax-option">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="includeLBTT">
                                    <span class="checkbox-text">LBTT (one-time purchase)</span>
                                </label>
                                <div class="input-group">
                                    <label for="actualLBTT">You paid:</label>
                                    <div class="input-wrapper">
                                        <span class="currency-symbol">£</span>
                                        <input type="number" id="actualLBTT" placeholder="0.00" step="0.01" min="0">
                                        <span class="input-suffix">when purchased</span>
                                    </div>
                                </div>
                            </div>

                            <p class="note-text">
                                <strong>Note:</strong> LBTT is a one-time cost. Consider this when comparing with annual Council Tax.
                            </p>

                            <button id="calculateBtn" class="calculate-btn">Calculate Comparison</button>
                        </div>

                        <div id="comparisonResults" style="display: none;">
                            <h3>Your Comparison</h3>

                            <div class="results-summary">
                                <div class="result-row">
                                    <span class="result-label">Current Total Tax:</span>
                                    <span class="result-value" id="totalCurrent">£0.00</span>
                                </div>
                                <div class="result-row">
                                    <span class="result-label">LVT Total:</span>
                                    <span class="result-value" id="totalLVT">£0.00</span>
                                </div>
                                <div class="result-row highlight">
                                    <span class="result-label" id="differenceLabel">Difference:</span>
                                    <span class="result-value" id="totalDifference">£0.00</span>
                                </div>
                            </div>

                            <div class="results-breakdown">
                                <h4>Breakdown</h4>
                                <table class="breakdown-table">
                                    <thead>
                                        <tr>
                                            <th>Tax Type</th>
                                            <th>Current</th>
                                            <th>Under LVT</th>
                                        </tr>
                                    </thead>
                                    <tbody id="breakdownTableBody"></tbody>
                                </table>
                            </div>

                            <button id="resetBtn" class="reset-btn">Calculate Another Property</button>
                        </div>
                    </div>
                </div>

                <!-- Information Panel -->
                <div class="panel info-panel">
                    <button class="info-toggle" id="infoToggle">
                        <span>About This Calculator</span>
                        <span class="toggle-icon">+</span>
                    </button>
                    <div class="info-content" id="infoContent">
                        <h3>About This Calculator</h3>
                        <p>This calculator lets you explore estimated land values for properties across Aberdeen and Aberdeenshire, and compare what you currently pay in Council Tax and/or Land and Buildings Transaction Tax (LBTT) against what you might pay under a Land Value Tax system.</p>

                        <h4>What is Land Value Tax?</h4>
                        <p>Land Value Tax (LVT) is a levy on the unimproved value of land, excluding buildings and other developments. Unlike Council Tax, it cannot be avoided by leaving land idle, and is widely regarded by economists as an efficient and equitable form of taxation.</p>

                        <h4>Methodology</h4>
                        <p>Land values were estimated using a residual method. For each of 1,586 properties with known sale prices, building replacement cost was estimated based on property type, floor area, and construction characteristics. Land value was then derived as the residual — the transaction price minus the estimated building cost. A gradient boosting model was trained on these residual land values using only land-intrinsic features: location, plot area, distance to amenities, flood risk, and local income levels. This approach avoids contaminating land value estimates with building quality and achieves an in-sample R² of 0.919, producing a total estimated regional land value of £15.2bn (median: £95k per property; Gini coefficient: 0.302). Land shares vary plausibly by property type, ranging from a median of 41% for detached houses to 56% for flats. LVT equivalent rates are calculated by dividing total regional tax revenues (Council Tax: £353m; LBTT: £53m) by total estimated land value, producing annual rates of 2.33% and 2.68% respectively, applied proportionally to each property's estimated land value. <a href="#" id="methodology-link" style="color: #2563eb;">View detailed analysis ↗</a></p>

                        <h4>Next Steps</h4>
                        <p>This pilot covers Aberdeen and Aberdeenshire. Future development aims to extend the analysis across Scotland and ultimately the rest of the UK, incorporate additional taxes beyond property-based levies — including income tax — to give a fuller picture of what a shift to LVT might mean in practice, and refine the underlying land value estimation methodology using EPC data for improved building cost estimates.</p>

                        <h4>Acknowledgements</h4>
                        <p>Transaction data: Registers of Scotland. Tax revenue data: Aberdeen City Council, Aberdeenshire Council, and Scottish Revenue. Accessibility and demographic data: Scottish Government and Ordnance Survey.</p>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>Land Value Tax Calculator | Data: Aberdeenshire &amp; Aberdeen | For demonstration purposes only</p>
        </div>
    </footer>

    <!-- Lightbox for methodology image -->
    <div id="methodologyLightbox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:9999; align-items:center; justify-content:center;">
        <div style="position:relative; max-width:95vw; max-height:95vh;">
            <button onclick="document.getElementById('methodologyLightbox').style.display='none';" style="position:absolute; top:-36px; right:0; background:none; border:none; color:white; font-size:28px; cursor:pointer; line-height:1;">✕</button>
            <img src="land_value_revised_analysis.png" alt="Revised Land Value Analysis" style="max-width:95vw; max-height:90vh; border-radius:6px; display:block;">
        </div>
    </div>

    <script src="https://unpkg.com/maplibre-gl@4/dist/maplibre-gl.js"></script>
    <script src="https://unpkg.com/pmtiles@3/dist/pmtiles.js"></script>
    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var link = document.getElementById('methodology-link');
            var lightbox = document.getElementById('methodologyLightbox');
            if (link && lightbox) {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    lightbox.style.display = 'flex';
                });
                lightbox.addEventListener('click', function(e) {
                    if (e.target === lightbox) lightbox.style.display = 'none';
                });
            }
        });
    </script>
</body>
</html>
